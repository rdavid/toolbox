#!/bin/sh
# vi:et lbr noet sw=2 ts=2 tw=79 wrap
# Copyright 2016-2022 David Rabkin
# Makes incremental backups from the first parameter to the second.
# shellcheck disable=SC1091,SC2034 # File not following, appears unused.
readonly BASE_APP_VERSION=0.9.20221222
. base.sh
[ "$#" -eq 2 ] || die Usage: bak.sh source destination.
validate_cmd rdiff-backup
readonly DST="$2" SRC="$1"
is_readable "$SRC" || die "$SRC" is not readable.
is_writable "$DST" || die "$DST" is not writable.
{
	rdiff-backup \
		--force \
		--preserve-numerical-ids \
		--print-statistics \
		--terminal-verbosity 4 \
		"$SRC" "$DST" \
		2>&1 1>&3 3>&- | to_loge
} \
	3>&1 1>&2 | to_log
